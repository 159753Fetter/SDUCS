Part1 准备：DHCP、UDP、IP和以太网
（1）生成DHCP请求，封装在UDP报文段，该UDP报文段被封装在IP数据报中，使用广播地址255.255.255.255和源地址0.0.0.0。

（2）IP数据报被放置在以太网帧中，该帧的目标MAC地址是FF:FF:FF:FF:FF:FF，源MAC地址是Bob便携机的MAC地址。

（3）带有DHCP请求的广播以太网帧到达以太网交换机，以太网交换机会向所有出端口发送广播帧，包括到路由器的端口。

（4）路由器收到广播以太网帧以后进行解封装，抽取出IP数据报，根据数据包广播IP目的地址，将数据报的载荷向上到达UDP，DHCP
请求报从UDP报文段中抽取出来，此时DHCP服务器有了DHCP请求报文。

（5）DHCP服务器生成DHCP ACK报文，包括分配的IP地址、DNS服务器的IP地址、默认网关路由器的IP地址、子网块。然后DHCP报文
被放入一个UDP报文段，UDP报文段被放入一个IP数据报，IP数据报被放入以太网帧中，帧的源MAC地址是路由器接入归属网络的MAC地址，
目标MAC地址是Bob便携机的MAC地址。

（6）包含DHCP ACK的以太网帧由路由器到达交换机，交换机之前已经自学习了Bob的MAC和相应的端口，于是向对应端口做转发。

（7）Bob的便携机收到DHCP ACK的以太网帧，依次解封装，记录下自己的IP地址和DNS服务器的IP地址，在IP转发表中安装默认网关的地址。

Part2 准备：DNS和ARP
Bob在浏览器中输入了谷歌的地址
（8）Bob便携机生成一个DNS查询报文，该报文被封装在UDP报文中，然后UDP报文被封装在IP报文中，而IP报文的源IP和目的IP之前由
DHCP ACK中提供。

（9）Bob便携机把包含DNS请求报文的数据报封装在以太网帧中，并把该以太网帧发到网关路由器，网关IP由之前DHCP ACK报文提供，但不知道
网关的MAC地址，需使用ARP协议获得网关的MAC地址。

（10）Bob便携机生成了一个目标IP为默认网关的ARP查询报文，并封装成以太网帧，目标地址是广播地址，向交换机发送

（11）网关路由器收到该帧，准备ARP回答，指示自己的MAC地址和IP地址，并将ARP回答放在一个以太网帧中，该帧的目标地址为Bob便携机，
发送给交换机最终到达Bob便携机。

（12）Bob收到ARP回答报文，并从ARP回答报文中抽取网关路由器的MAC地址。

（13）Bob发出DNS查询的以太网帧，该帧的IP地址是DNS服务器的IP地址，该帧的目标MAC地址是网关路由器的MAC地址，先发送到交换机，
后发送到网关路由器。

Part3准备：域内路由选择到DNS服务器
（14）网关路由器解封装该帧并抽取DNS查询的IP数据报，根据该数据报的目的地址，并根据转发表决定下一跳和输出端口，以送至目标。

（15）中间路由器也根据自己的转发表，进行相应的存储-转发（转发表的填写时根据所在AS域内协议和BGP域间协议来完成）。

（16）DNS查询的IP数据报到达DNS服务器，服务器抽取出DNS查询报文，在它的DNS数据库中找到相应记录，生成DNS回答报文，
并将DNS回答报文放入UDP报文段中，该报文段后被封装成IP数据报，之后将该数据报发出，目标IP为Bob便携机，在各路由器查转发表，各端口查ARP表
、交换机查转发表到达Bob机。

（17）Bob从DNS报文中抽取www.google.com的IP地址。

Part4：Web C/S交互
（18）在Bob便携机上生成TCP套接字，用于向www.google.com发送报文，首先Bob便携机的TCP先于www.google.com的TCP执行三次握手，Bob便携机
先生成一个TCP SYN的报文段，经过交换机、路由器到达www.google.com。

（19）www.google.com生成TCP套接字，向Bob发送TCP SYNACK报文段，同样经过交换机、路由器到达Bob便携机。

（20）Bob收到TCP SYNACK，建立起连接。

（21）借助套接字发送包含URL的HTTP GET报文，当www.google.com收到报文以后生成HTTP响应报文，该响应报文最后到达Bob交换机。